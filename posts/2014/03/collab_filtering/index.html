<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Collaborative item-based filtering for specific demographics / Data in the Rough</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <link rel="shortcut icon" href="../../../../theme/favicon.ico" />
        <link rel="apple-touch-icon" href="../../../../theme/apple-touch-icon-iphone.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="../../../../theme/apple-touch-icon-ipad.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="../../../../theme/apple-touch-icon-iphone4.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="../../../../theme/apple-touch-icon-ipad3.png" />

        <link rel="stylesheet" href="../../../../theme/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../../../theme/css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="../../../../theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="../../../../theme/css/colorbox.css">

        <link rel="stylesheet" href="../../../../theme/css/main.css">

        <script src="../../../../theme/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div class="span9">
                    <div class="row">
                    

                        <div class="span7"> <!-- header -->
                            <!--[if lt IE 9]>
                                <p class="chromeframe alert alert-warning">You are using an <strong>outdated</strong> browser, and this site might not look best in it. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
                            <![endif]-->
                            <header id="site-header">
                                <div id="site-header-content">
                                    <h1>
                                        <a href="../../../..">Data in the Rough</a>
                                        <small>
                                            <span class="divider">/</span> Exploring data science and visualization
                                        </small>
                                    </h1>
                                    <p>
                                        
                                    </p>
                                </div>
                            </header>
                        </div> <!-- header span -->
                    </div> <!-- header row -->

                    <div class="row"> <!-- content -->
                        <div class="content">
<div class="article-page">
    <div class="span7 offset2">
        <header class="article">
            <h2><a href="../../../../posts/2014/03/collab_filtering/" rel="bookmark">Collaborative item-based filtering for specific demographics</a></h2>
            <time datetime="2014-03-18T00:00:00">
                Mar 18, 2014
            </time>
        </header>
    </div>

    <div class="span2">
    <div class="article-meta article-meta-border">
        <dl class="dl-horizontal">
            <dt><i class="icon-file"></i></dt>
            <dd>
                <a href="../../../../category/scikit-learn.html">
                    Scikit-learn
                </a>
            </dd>

            <dt><i class="icon-tags"></i></dt>
            <dd>
                    <a href="../../../../tag/collaborative-filtering.html">Collaborative filtering</a>
<span class="separator">/</span>                    <a href="../../../../tag/scikit-learn.html">Scikit-learn</a>
            </dd>
        </dl>

        <b class="border-notch notch"></b>
        <b class="notch"></b>
    </div>
    </div>

    <div class="span7">
        <section>
            <article class="entry">
    <p>This post is inspired by a situation I find myself in sometimes – going back home every year or so and deciding on movies to watch with my parents. I’ve lived on the opposite coast from them for about 6 years, so I don’t have a lot of data about their movie preferences as of late. Making them fill out a movie survey would be time consuming for them. I do know other things about them, though! I know their ages, I know their jobs, I know where they live. I also, obviously, have a lot of data about my own movie preferences. What if I could combine my movie preferences with their demographic info to get some recommendations for what movies we might want to watch together? </p>
<p>I am going to show you how to do this by adapting an algorithm from the book Programming Collective Intelligence: Building Smart Web 2.0 Applications by Toby Segaran.</p>
<p>Segaran describes collaborative item-based filtering. He uses the Euclidean distance score  to find out how similar films are to one another, and which films are most similar to the films that someone rates highly.</p>
<p>The idea is that you can rate as many movies on this list as you like, and then get back a list of recommendations.</p>
<p>The process Segaran uses goes, very generally, like this:</p>
<p 1_="1," 3="3" 3_:="3’:" 5_="5," Hereafter_:="Hereafter’:" Shell_:="Shell’:" Sweet="Sweet" _Gattaca_:="‘Gattaca’:" _Ghost="{‘Ghost" _Katie_:="‘Katie’:" _Robocop="‘Robocop" _The="‘The" in="in" the="the">1) Create a nested dictionary that matches movies to their rating for each rater. One rater entry for a small list of movies would look something like this:</p>
<p>In the MovieLens set, the raters are ID numbers and not names. Segaran used names as an example for clarity; I borrowed that strategy from him.</p>
<p>2)  Write a function that returns the Euclidean distance between two points. You can also use the Pearson Correlation Score, but I’m not going to do that right now – I’ll get to the reason in a bit. 
3)  Write a function that inverts the dictionary to be one that matches raters to their rating for each movie. (e.g. {‘Ghost in the Shell’: {‘Katie’ : 5, ‘Judy’: 4, ‘Tommy’: 3}}) 
4)  Write a function that generates a list of similarity scores based on Euclidean distance between any given item and every other item in the dictionary. Then, the function should sort the results in order of similarity. This function uses the Euclidean distance function from #2.
a.  This brings us back to the reason I did not use the Pearson correlation score. When calculating similarity of raters, the Pearson score makes a lot of sense, because it corrects for score inflation – in other words, if one rater routinely is harsher than another but their relative scores of the different movies are similar, the Pearson score will calculate them as more similar than will the Euclidean distance score. Correcting with that sort of inflation seems very logical for rater similarity but seems a bit more complicated with item similarity. I don’t necessarily want two movies that have very different ratings but have the same relative preferedness among the raters to be scored as similar. I want to account for the fact that one movie gets higher ratings – I don’t want to correct for “movie inflation” because that information seems to have value. I’m absolutely open to being proven wrong on this decision.
5)  Write a function that “loops over every item and passes the transformed dictionary to the topMatches function (described in #3) to get the most similar items along with their similarity scores. Finally, it creates and returns a dictionary of items along with a list of their most similar items.” (from p. 23 of the book). 
6)  Finally, write a function that (barely paraphrasing, often quoting):
a.   Loops over the items rated by any given user (you get the ratings by user from the original, user-based dict)
b.   Loops over items similar to this one as calculated by the previous function (but ignore the ones the user has already rated)
c.  Calculates the weighted sum of rating times similarity
d.  Sums all the similarities
e.  Divides each total score by the total weighting – now you have an average
f.  Returns the rankings from the highest to lowest.</p>
<p>At the end of this, you have a list of the movies with the highest score – the score representing how similar a movie is to the movies you rate most highly. </p>
<p>There’s a wonderful dataset called MovieLens from the University of Minnesota, (link here) on which Segaran runs his item-based filtering code, and I used it to implement his code.  I had a lot of fun doing this so I decided to play around a little bit…</p>
<p>…which brings us back to the demographic-based recommendation idea I mentioned at the beginning of this post. I’m going to focus just on age right now, with the idea that we can add in other demographic information as we wish, using the same method. I want a list of movies that are similar to my interests, based only on the age group that is similar to my parents.</p>
<p>This can be accomplished by telling the script to only look at ratings from a specific age bracket when calculating the Euclidean distance of two items. Here is Segaran’s function for Euclidean distance, slightly modified to incorporate a specific age bracket. Variable names are also changed from the book version to clarify that this code is being used for item, not user, similarity.</p>
<p>Now you have a Euclidean distance between two movies, in which only a specific age bracket has been taken into account. Now you just need to make sure that you have those age inputs in any subsequent function that references the sim_distance function. That way, you can just input the ages into the final function that references all the other functions, and it’ll just plug them in wherever that sim_distance function is used. For example, here’s the modified version of function #4 and function #5:</p>
<p>Function #4: </p>
<p>Function #5: </p>
<p>Function #6:</p>
<p>Now, you can calculate the item similarity dictionary, get a list of movies, and their ratings, similar to the tastes of any given user, and specific to a certain demographic!</p>
<p>I did not actually rate these movies, so I am going to cheat and choose an arbitrary 24-year-old from this dataset – let’s say my 24-year-old friend, rater number 4, is going to hang out with my parents instead of me. The input to obtain the first 31 movie recommendations would look like this:</p>
<p>itemMatch = calculateSimilarItems(prefs, 40, 75)</p>
<p>getRecommendedItems(prefs, itemMatch, 4)[0:30]</p>
<p>(I’m not going to get more specific with my parents’ age range because that would be rude.)</p>
<p>The output would be:</p>
<p>[(5.0, 'Temptress Moon (Feng Yue) (1996)'), (5.0, 'Shooting Fish (1997)'), (5.0, 'Letter From Death Row, A (1998)'), (5.0, 'Legal Deceit (1997)'), (5.0, 'Frankie Starlight (1995)'), (5.0, 'Convent, The (Convento, O) (1995)'), (5.0, 'Children of the Revolution (1996)'), (5.0, 'Chairman of the Board (1998)'), (4.910804627925347, 'Unhook the Stars (1996)'), (4.833333333333333, 'High School High (1996)'), (4.833333333333333, 'American Strays (1996)'), (4.818181818181818, 'Hotel de Love (1996)'), (4.7894736842105265, 'American Buffalo (1996)'), (4.749999999999999, 'Man of the House (1995)'), (4.749999999999999, 'Major Payne (1994)'), (4.749999999999999, 'Low Down Dirty Shame, A (1994)'), (4.749999999999999, 'Lightning Jack (1994)'), (4.749999999999999, 'I Love Trouble (1994)'), (4.749999999999999, 'Cops and Robbersons (1994)'), (4.737704918032787, 'Bloodsport 2 (1995)'), (4.703703703703704, 'Two Deaths (1995)'), (4.673094212473764, 'Beavis and Butt-head Do America (1996)'), (4.666666666666667, 'Young Guns II (1990)'), (4.666666666666667, 'Little City (1998)'), (4.654320987654322, 'Solo (1996)'), (4.625, 'Spice World (1997)'), (4.619052786367143, 'Wizard of Oz, The (1939)'), (4.611078667402663, 'Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb (1963)'), (4.609392286807124, 'Rent-a-Kid (1995)'), (4.608348198368234, 'Babe (1995)')]</p>
<p>You only have to create the itemMatch dict once for every age group (in fact, you can set a different variable name for different age groups if you want to come back to them), and then you can just run that second line for the specific user, and update the itemMatch dictionary if you end up entering new subjects.</p>
<p>This could all be conducted for any demographic. You can set up the function to take a certain zip code as input, or an occupation, and thereby control the raters accounted for in the Euclidean distance score between items. </p>
<p>I’m looking forward to inputting my own movie ratings and actually running this for myself instead of my anonymous contemporary.</p>
<p>I hope you enjoyed this. Have a good week, everyone. </p>

            </article>
        </section>
    </div> <!-- span -->
</div>                        </div>
                    </div> <!-- content row -->

                    <div class="row"> <!-- footer -->
                        <div class="span7 offset2">
                            <footer id="site-footer">
                                <p>
                                    <a href="" target="_blank">
                                        
                                    </a> Katie Green /
                                    <a href="../../../../">Archives</a>
                                </p>
                                <p>
                                    Powered by
                                    <a href="https://github.com/getpelican/pelican" target="_blank">
                                        Pelican
                                    </a>
                                    /
                                    Source code on
                                    <a href="http://github.com/siovene/iovene.com" target="blank">
                                        GitHub
                                    </a>
                                    /
                                    Theme <code>Lannisport</code>, also on
                                    <a href="http://github.com/siovene/lannisport" target="_blank">
                                        GitHub
                                    </a>
                                </p>
                            </footer>
                        </div> <!-- footer span -->
                    </div> <!-- footer row -->
                </div> <!-- header+content+footer span -->

                <div class="span3">
                    <aside class="affix">
                        <div id="sidebar">
                            <div id="social-icons">
                                    <span class="social-icon">
                                        <a href="http://www.linkedin.com/pub/katie-green/12/651/70a" target="_blank" title="LinkedIn">
                                            <i class="icon-linkedin"></i>
                                        </a>
                                    </span>
                                    <span class="social-icon">
                                        <a href="https://twitter.com/katie_fg" target="_blank" title="Twitter">
                                            <i class="icon-twitter"></i>
                                        </a>
                                    </span>
                            </div>

                            <div id="navigation">
<nav>
	<h2>Pages</h2>
	<ul>
		<li>
			<ul>
				<li>
					<a href="../../../..">Blog</a>
				</li>

					<li>
						<a href="../../../../pages/about.html">About</a>
					</li>
					<li>
						<a href="../../../../pages/blogs.html">Links and blogs</a>
					</li>
					<li>
						<a href="../../../../pages/contact.html">Contact</a>
					</li>
					<li>
						<a href="../../../../pages/license.html">License</a>
					</li>
			</ul>
		</li>
	</ul>
</nav>

<nav>
	<h2>Categories</h2>
	<ul>
		<li>
			<ul>
					<li>
						<a href="../../../../category/data-science.html">data science</a>
					</li>
					<li>
						<a href="../../../../category/pelican-blogging.html">Pelican blogging</a>
					</li>
					<li>
						<a href="../../../../category/scikit-learn.html">Scikit-learn</a>
					</li>
			</ul>
		</li>
	</ul>
</nav>                            </div>
                        </div> <!-- sidebar -->

                        <p id="back-to-top">
                            <a href="#">
                                <i class="icon-double-angle-up"></i> Back to top
                            </a>
                        </p>

                    </aside>
                </div> <!-- logo+navigation span -->
            </div> <!-- row -->

        </div> <!-- /container -->

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="../../../../theme/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>

        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>
        <script>$('body').popover || document.write('<script src="../../../../theme/js/vendor/bootstrap.min.js"><\/script>')</script>

        <script src="../../../../theme/js/jquery.captions.js"></script>
        <script src="../../../../theme/js/vendor/jquery.colorbox-min.js"></script>

        <script src="../../../../theme/js/main.js"></script>

        <script>
            var _gaq=[['_setAccount',''],['_trackPageview'],['_trackPageLoadTime'],['_gat._anonymizeIp']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>